import{EventTypes as R}from"@imrobot/shared";import{ErrorEventTypes as u,ErrorTypes as l,getTimestamp as y,reportData as f}from"@imrobot/shared";import v from"error-stack-parser";import S from"md5";var h=new Set;var p=e=>S(e);function c(e){return h.has(e)?!0:(h.add(e),!1)}var T=e=>{let{fileName:o,columnNumber:t,lineNumber:r}=v.parse(e)[0],n={type:u.ERROR,fileName:o,url:location.href,message:e.message,lineNumber:r,columnNumber:t,time:y()},a=p(`${n.type}-${n.message}-${n.url}-${n.columnNumber}`);if(!c(a))return f("/error/code",n),l.CODE},x=({src:e,localName:o,href:t})=>{let r={url:location.href,type:u.RESOURCE,source:e||t,target:o,time:y()},n=p(`${r.type}-${r.source}-${r.url}-${r.target}`);if(!c(n))return f("/error/resource",r),l.RESOURCE},D=e=>{if(e.reason.name==="AxiosError")return;let{fileName:o,columnNumber:t,lineNumber:r}=v.parse(e.reason)[0],n={type:u.UNHANDLEDREJECTION,fileName:o,url:location.href,message:e.reason.message,lineNumber:r,columnNumber:t,time:y()},a=p(`${n.type}-${n.message}-${n.url}-${n.columnNumber}`);if(!c(a))return f("/error/code",n),l.CODE},H=e=>{let{url:o,sendTime:t,status:r,elapsedTime:n,response:a,requestData:d,method:L}=e;if(r===0||r>=400){let i={type:u.XHR,url:location.href,requestURL:o,time:t,status:r,response:a,elapsedTime:n,method:L,requestData:d},I=p(`${i.type}-${i.response}-${i.method}-${i.status}`);if(!c(I))return f("/error/request",i),l.REQUEST}};import{EventTypes as s,global as w}from"@imrobot/shared";import{EventTypes as C,getTimestamp as N}from"@imrobot/shared";var A=()=>{q(),P()},q=()=>{let e=XMLHttpRequest.prototype,o=e.open;e.open=function(...t){let r=this;r.data={method:t[0],url:t[1],sendTime:N()},o.apply(r,t)}},P=()=>{let e=XMLHttpRequest.prototype,o=e.send;e.send=function(...t){let r=this;r.data.requestData=t[0],r.addEventListener("loadend",()=>{let{responseType:n,response:a,status:d}=r;["","json","text"].includes(n)&&(r.data.response=a,r.data.status=d,r.data.elapsedTime=new Date(N()).getTime()-new Date(r.data.sendTime).getTime()),E(C.XHR,r.data)}),o.apply(r,t)}};var g={},j={[s.VUE]:e=>J(e),[s.ERROR]:()=>M(),[s.UNHANDLEDREJECTION]:()=>V(),[s.XHR]:()=>A()},m=(e,o,t)=>{if(e in g)return!1;g[e]=o;let r=j[e];return t?r&&r(t):r&&r(),!0},E=(e,...o)=>{w.hasError=!0;let t=g[e];if(t){let r=t(...o);r&&k(r)}},J=e=>{e.config.errorHandler=o=>{E(s.VUE,o)}},M=()=>{window.addEventListener(s.ERROR,e=>E(s.ERROR,e),!0)},V=()=>{window.addEventListener(s.UNHANDLEDREJECTION,e=>E(s.UNHANDLEDREJECTION,e))},U=[],b=e=>{U.push(e)},k=e=>{U.forEach(o=>{setTimeout(()=>{o(e)},0)})};var O=(e,o)=>{m(R.VUE,t=>T(t),e),m(R.ERROR,t=>{let r=t.target;return r!=null&&r.localName?x(r):T(t.error)}),m(R.UNHANDLEDREJECTION,t=>D(t)),m(R.XHR,t=>H(t)),F()},$=[],X=(e,o)=>{$.push(()=>e.install(o)),e.afterEvent&&b(e.afterEvent)},F=()=>{$.forEach(e=>{e()})};import{default as de}from"@imrobot/behavior";import{playScreen as ye,default as Te}from"@imrobot/screen";var Q={install:O,use:X},le=Q;export{de as behavior,le as default,ye as playScreen,Te as screen};
//# sourceMappingURL=index.mjs.map