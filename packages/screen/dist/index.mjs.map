{"version":3,"sources":["../src/record.ts","../src/play.ts","../src/index.ts"],"sourcesContent":["import { reportData } from \"@imrobot/monitor-helpers\";\nimport { Base64 } from \"js-base64\";\nimport pako from \"pako\";\nimport { record } from \"rrweb\";\n\nexport const events: any[] = [];\n\nexport const onScreen = () => {\n  record({\n    emit(event) {\n      events.push(event);\n    },\n  });\n};\n\nexport const install = () => {\n  onScreen();\n};\n\nexport const afterEvent = (time: number) => {\n  const data = { time, data: zip(events) };\n  reportData(\"/screen\", data);\n  events.length = 0;\n  record.takeFullSnapshot(true);\n};\n\nexport function zip(data: any[]): string {\n  if (!data) return data;\n  const base64Str = Base64.encode(JSON.stringify(data));\n  const zipData = pako.gzip(base64Str);\n  const zipDataArray = Array.from(zipData);\n  let result = \"\";\n  zipDataArray.forEach((item: any) => {\n    result += String.fromCharCode(item);\n  });\n  return Base64.btoa(result);\n}\n","import { Base64 } from \"js-base64\";\nimport pako from \"pako\";\nimport rrwebPlayer from \"rrweb-player\";\n/**\n * https://github.com/rrweb-io/rrweb/tree/master/packages/rrweb-player/#installation\n */\nimport \"rrweb-player/dist/style.css\";\n\nexport const playScreen = (\n  el: HTMLElement,\n  b64Data: string,\n  width?: number\n) => {\n  const events = unzip(b64Data);\n  new rrwebPlayer({\n    target: el,\n    props: {\n      events,\n      width,\n    },\n  });\n};\n\nfunction unzip(b64Data: string) {\n  let strData = Base64.atob(b64Data);\n  let charData = strData.split(\"\").map(function (x) {\n    return x.charCodeAt(0);\n  });\n  let binData = new Uint8Array(charData);\n  let data = pako.ungzip(binData);\n  // ↓切片处理数据，防止内存溢出报错↓\n  let str = \"\";\n  const chunk = 8 * 1024;\n  let i;\n  for (i = 0; i < data.length / chunk; i++) {\n    str += String.fromCharCode.apply(\n      null,\n      data.slice(i * chunk, (i + 1) * chunk)\n    );\n  }\n  str += String.fromCharCode.apply(null, data.slice(i * chunk));\n  // ↑切片处理数据，防止内存溢出报错↑\n  const unzipStr = Base64.decode(str);\n  return JSON.parse(unzipStr);\n}\n","import { Extension } from \"@imrobot/monitor-helpers\";\nimport { afterEvent, install } from \"./record\";\nexport * from \"./play\";\n\nconst extension: Extension = {\n  install,\n  afterEvent,\n};\n\nexport default extension;\n"],"mappings":"AAAA,OAAS,cAAAA,MAAkB,2BAC3B,OAAS,UAAAC,MAAc,YACvB,OAAOC,MAAU,OACjB,OAAS,UAAAC,MAAc,QAEhB,IAAMC,EAAgB,CAAC,EAEjBC,EAAW,IAAM,CAC5BF,EAAO,CACL,KAAKG,EAAO,CACVF,EAAO,KAAKE,CAAK,CACnB,CACF,CAAC,CACH,EAEaC,EAAU,IAAM,CAC3BF,EAAS,CACX,EAEaG,EAAcC,GAAiB,CAC1C,IAAMC,EAAO,CAAE,KAAAD,EAAM,KAAME,EAAIP,CAAM,CAAE,EACvCJ,EAAW,UAAWU,CAAI,EAC1BN,EAAO,OAAS,EAChBD,EAAO,iBAAiB,EAAI,CAC9B,EAEO,SAASQ,EAAID,EAAqB,CACvC,GAAI,CAACA,EAAM,OAAOA,EAClB,IAAME,EAAYX,EAAO,OAAO,KAAK,UAAUS,CAAI,CAAC,EAC9CG,EAAUX,EAAK,KAAKU,CAAS,EAC7BE,EAAe,MAAM,KAAKD,CAAO,EACnCE,EAAS,GACb,OAAAD,EAAa,QAASE,GAAc,CAClCD,GAAU,OAAO,aAAaC,CAAI,CACpC,CAAC,EACMf,EAAO,KAAKc,CAAM,CAC3B,CCpCA,OAAS,UAAAE,MAAc,YACvB,OAAOC,MAAU,OACjB,OAAOC,MAAiB,eAIxB,MAAO,8BAEA,IAAMC,EAAa,CACxBC,EACAC,EACAC,IACG,CACH,IAAMC,EAASC,EAAMH,CAAO,EAC5B,IAAIH,EAAY,CACd,OAAQE,EACR,MAAO,CACL,OAAAG,EACA,MAAAD,CACF,CACF,CAAC,CACH,EAEA,SAASE,EAAMH,EAAiB,CAE9B,IAAII,EADUT,EAAO,KAAKK,CAAO,EACV,MAAM,EAAE,EAAE,IAAI,SAAUK,EAAG,CAChD,OAAOA,EAAE,WAAW,CAAC,CACvB,CAAC,EACGC,EAAU,IAAI,WAAWF,CAAQ,EACjCG,EAAOX,EAAK,OAAOU,CAAO,EAE1BE,EAAM,GACJC,EAAQ,EAAI,KACdC,EACJ,IAAKA,EAAI,EAAGA,EAAIH,EAAK,OAASE,EAAOC,IACnCF,GAAO,OAAO,aAAa,MACzB,KACAD,EAAK,MAAMG,EAAID,GAAQC,EAAI,GAAKD,CAAK,CACvC,EAEFD,GAAO,OAAO,aAAa,MAAM,KAAMD,EAAK,MAAMG,EAAID,CAAK,CAAC,EAE5D,IAAME,EAAWhB,EAAO,OAAOa,CAAG,EAClC,OAAO,KAAK,MAAMG,CAAQ,CAC5B,CCxCA,IAAMC,EAAuB,CAC3B,QAAAC,EACA,WAAAC,CACF,EAEOC,EAAQH","names":["reportData","Base64","pako","record","events","onScreen","event","install","afterEvent","time","data","zip","base64Str","zipData","zipDataArray","result","item","Base64","pako","rrwebPlayer","playScreen","el","b64Data","width","events","unzip","charData","x","binData","data","str","chunk","i","unzipStr","extension","install","afterEvent","src_default"]}